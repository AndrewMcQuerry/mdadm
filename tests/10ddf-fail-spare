# sanity check array creation
. tests/env-ddf-template

mdadm --zero-superblock $dev8 $dev9 $dev10 $dev11 $dev12 $dev13
mdadm -CR $container -e ddf -l container -n 5 $dev8 $dev9 $dev10 $dev11 $dev12

mdadm -CR $member0 -l raid1 -n 2 $container >/tmp/mdmon.txt 2>&1
#$dir/mdadm -CR $member0 -l raid1 -n 2 $container >/tmp/mdmon.txt 2>&1

check wait

set -- $(get_raiddisks $member0)
fail0=$1
mdadm -f $member0 $fail0

# need to sleep shortly here, to give monitor some time to active the spare
sleep 0.5
check wait

if mdadm -CR $member1 -l raid5 -n 3 $container; then
   echo error: create should have failed
   set -- $(get_raiddisks $member0)
   d0=$1
   set -- $(get_raiddisks $member1)
   d1=$1
   cat /proc/mdstat
   mdadm -E $d0
   mdadm -E $d1
   mdadm -E $fail0
   rv=1
#   cat /tmp/mdmon.txt
else
   rv=0
fi

#  rm -f /tmp/mdmon.txt
exit $rv
